{% set goname = "github.com/github/hub" %}
{% set version = "2.7.0" %}

{% set name = goname.split('/')[-1] %}
{% set pkg_src = ('src/'+goname).replace("/",os.sep) %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - folder: {{ pkg_src }}
    url: https://{{ goname }}/archive/v{{ version }}.tar.gz
    sha256: 58d131c32404c963b06bcc067bda14317bc22be26187026a91960aecda324bf4

build:
  number: 1000
  script:
    - pushd {{ pkg_src }}
    - go install -v .

    # Note the semicolons
    - bash -euf -c "
        etc_conda=$PREFIX/etc/conda;
        for F in activate deactivate; do
          mkdir -p $etc_conda/$F.d;
          cp -v $RECIPE_DIR/$F.sh $etc_conda/$F.d/hub.sh;
        done;
        mkdir -p
          $PREFIX/etc/bash_completion.d;                  # [unix]
          $LIBRARY_PREFIX/etc/bash_completion.d;          # [win]
        cp etc/hub.bash_completion.sh
          $PREFIX/etc/bash_completion.d/hub.sh;           # [unix]
          $LIBRARY_PREFIX/etc/bash_completion.d/hub.sh;   # [win]
      "

requirements:
  build:
    - {{ compiler('go') }}
    - m2-coreutils  # [ win ]
    - m2-bash  # [win]

test:
  requires:
    - m2-grep  # [ win ]
  commands:
    - bash -euf -c "
        hub version | grep -q '{{ name }} version {{ version }}';
        test -f $PREFIX/etc/conda/activate.d/hub.sh;
        test -f $PREFIX/etc/conda/deactivate.d/hub.sh;
        test -f $PREFIX/etc/bash_completion.d/hub.sh;             # [unix]
        test -f $LIBRARY_PREFIX/etc/bash_completion.d/hub.sh;     # [win]
      "

about:
  home: https://github.com/github/hub
  license: MIT
  license_family: MIT
  license_file: src/github.com/github/hub/LICENSE
  summary: 'git + hub = github'

  description: |
    hub is a command line tool that wraps git in order to extend it with
    extra features and commands that make working with GitHub easier.
  dev_url: https://github.com/github/hub

extra:
  recipe-maintainers:
    - sodre
    - asford
